# fibonacci_stable

Калькулятор чисел Фибоначчи на Rust с безопасной обработкой переполнения, двуязычными сообщениями об ошибках (RU/EN), логированием и полным покрытием тестами.

## Возможности

- **Безопасное вычисление** — `fibonacci()` использует `try_fold` + `checked_add`, возвращает `Result` без паник при переполнении `u128`
- **Валидация ввода** — обработка пустого ввода, отрицательных чисел, дробей, нечисловых символов, множественного ввода, слишком больших чисел
- **Двуязычные ошибки** — каждая ошибка выводится на русском и английском
- **Логирование** — все действия пользователя и вычисления фиксируются с таймстемпами
- **Покрытие кода** — 93.94% (cargo-tarpaulin)
- **Тесты** — unit-тесты, integration-тесты, e2e-тесты, property-based тесты (proptest), doc-тесты
- **Fuzz-тестирование** — 65+ млн итераций через cargo-fuzz (libFuzzer), 0 крашей
- **Документация** — `///` doc-комментарии, HTML-документация в `doc/`

## Запуск

```bash
cargo run
```

## Пример работы

```
Введите число для вычисления Фибоначчи:
10
fibonacci(10) = 55

--- Логи ---
[2026-02-09 12:00:00.000] Программа запущена
[2026-02-09 12:00:01.000] Ввод от пользователя: '10'
[2026-02-09 12:00:01.001] Старт вычисления fibonacci(10)
[2026-02-09 12:00:01.001] Конец вычисления: fibonacci(10) = 55
[2026-02-09 12:00:01.001] Результат выведен в терминал
```

## Тесты

```bash
cargo test
```

### Покрытие тестами

| Модуль | Что тестируется |
|---|---|
| `fibonacci` | Базовые значения, граничное значение (186), свойство суммы, тождество Кассини, переполнение, proptest |
| `errors` | Форматирование всех типов ошибок (RU + EN), ComputationError |
| `io` | Парсинг всех видов некорректного ввода, proptest |
| `logger` | Порядок записей, формат таймстемпов, proptest |
| `tests/integration.rs` | Полный workflow: ввод → вычисление → логирование |
| `tests/e2e.rs` | Запуск бинарника с stdin/stdout — валидный ввод, ошибки, восстановление, выход |

## Fuzz-тестирование

Проект прошёл фазз-тестирование с помощью [cargo-fuzz](https://github.com/rust-fuzz/cargo-fuzz) (libFuzzer). Фаззер генерирует миллионы случайных входов и проверяет, что функции не паникуют.

```bash
# Требуется nightly-тулчейн
cargo +nightly fuzz run <target> -- -max_total_time=120
```

### Fuzz-таргеты и результаты

| Таргет | Что тестирует | Итераций | Время | Крашей |
|---|---|---|---|---|
| `fuzz_parse_input` | `parse_input()` — парсинг произвольных строк | 32 531 640 | 61 сек | **0** |
| `fuzz_fibonacci` | `fibonacci()` — вычисление для произвольных `u128` | 33 111 708 | 61 сек | **0** |

> **65.6 млн** случайных входов без единой паники — функции стабильны.

## Документация

```bash
cargo doc --no-deps --open
```

## Структура проекта

```
src/
├── main.rs                 — точка входа, основной цикл
├── lib.rs                  — публичный API модулей
├── fibonacci.rs            — fibonacci() с try_fold + checked_add → Result
├── errors.rs               — InputError, ComputationError с Display (RU/EN)
├── io.rs                   — чтение и валидация ввода, вывод результата
└── logger.rs               — Logger с таймстемпами (chrono)
tests/
├── integration.rs          — интеграционные тесты
└── e2e.rs                  — end-to-end тесты
fuzz/fuzz_targets/
├── fuzz_parse_input.rs     — фаззинг парсера ввода
└── fuzz_fibonacci.rs       — фаззинг вычисления Фибоначчи
```

## Зависимости

- [chrono](https://crates.io/crates/chrono) — таймстемпы в логах
- [proptest](https://crates.io/crates/proptest) (dev) — property-based тестирование
- [regex](https://crates.io/crates/regex) (dev) — проверка формата логов в тестах
- [cargo-fuzz](https://github.com/rust-fuzz/cargo-fuzz) / [libfuzzer-sys](https://crates.io/crates/libfuzzer-sys) — fuzz-тестирование
- [cargo-tarpaulin](https://github.com/xd009642/tarpaulin) — покрытие тестами